
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script type="module" src="./app.js"></script>
    <link rel="stylesheet" href="../styles/style.sass">
    <title>Clean App</title>
</head>
<body>
    <Header id=Header init="{asd: 'asdfsadf'}" traps="asdf"></Header><a href="">asdf</a></Header>
    <Home id='Home, mate'></Home>
    <ChangeStateButton id=""></ChangeStateButton>
    
        
    
    <Footer id=""><div id="footerDiv">and your <strong>footer</strong> last</div></Footer></Footer>
</body>
<script>
    console.log(document.getElementById('Home, mate'))
    class Store {
        constructor (concern, init={}, traps={}, push=null) {
            this._concern = concern;
            if (concern === 'app') {
                this.legacy = {test: ''};
                this._dynasty = { app: {} }
            } else now.legacy = now._dynasty = concern;
            this._diff = {};
            this._init = init;
            this.state = {};
            if (Object.entries(init).length) {
                for (let entry in init) { this.state[entry] = init[entry] }
            };
            const handler = {
                get: (target, property, self) => {
                    console.log(property)
                    if (property === 'check') Reflect.get(target, property, self)
                    if (['_concern', '_diff', '_init', 'state', 'legacy', '_dynasty'].includes(property)) console.log(target[property]);
                    if (property === 'target') console.log(target);
                    if (property in this._diff) { delete this._diff[property] }
                    return ['_concern', '_diff', '_init', 'state', '__clear__', 'check'].includes(property) ? target[property] : Reflect.get(target.state, property, self)
                },
                set: (target, property, value, self) => {
                    if ('concern,diff,init,state'.match(property.replace(/_/g, '').toLowerCase())) {
                        console.log('State items may not resemble top-level properties')
                    } else {
                        if (property === '_dynasty') { target._dynasty['app'][value] = {}; true }
                        if (property === 'legacy') { this.legacy[value] = {}; true }
                        if (property === 'legacyExtension') { this.legacy[value[0]] = value[1]; true }
                        if (property === 'onClear') { now.legacyExtension = [this._concern, value]; true
                        } else this._diff[property] = this.state[property] = value; return true;
                    }
                    return true;
                }
            };
            const handlerInsert = (trap, plus) => {
                let value = handler[trap];
                value = `${value}`.split('return');
                value.splice(1, 0, 'return');
                value.splice(1, 0, plus);
                value.unshift('(');
                value.push(')');
                handler[trap] = eval(value.join(''));
            }
            
            if (Object.entries(traps).length) {
                for (let trap in traps) { 
                    if (trap === 'set' || trap === 'get') {
                        handlerInsert(trap, `${traps[trap]}`);
                    } else handler[trap] = eval(traps[trap]);
                }
                if (push) {
                    for (trap in handler) {
                        handlerInsert(trap, `\nif (this._diff.length) {
                            for (let property in this._diff) { push[property] = this._diff[property] }
                        }\n`);
                    }
                }
            }
            return new Proxy(this, handler)
        };
        check(what) { what ? this[what] : this.target };
        __clear__() {
            for (let property in this.state) { delete this.state[property] }
            if (Object.entries(now.legacy[this._concern]).length) {
                for (let property in now.legacy[this._concern]) { this[property] = now.legacy[this._concern][property] }
            }
        };
        
        __fullclear__() {
            for (let property in this.state) { delete this.state[property] }
            if (Object.entries(this._init).length) {
                for (let property in this._init) { this[property] = this._init[property] }
            }
        }
    };
    const now = new Store('app');
</script>
<script defer>
                                        
                            
    
</script>
</script>
</body>
</html>